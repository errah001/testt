<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Wallet Connect</title>
</head>
<body>
    <h1>Connect to Crypto Wallet</h1>
    <button id="connectButton">Connect Wallet</button>
    <button id="disconnectButton" style="display:none;">Disconnect Wallet</button>
    <div id="status"></div>

    <script>
        const networks = [
            {
                chainId: 1,
                name: 'Ethereum Mainnet',
                nativeSymbol: 'ETH',
                rpcUrls: ['https://mainnet.infura.io/v3/YOUR_INFURA_KEY']
            },
            {
                chainId: 56,
                name: 'Binance Smart Chain',
                nativeSymbol: 'BNB',
                rpcUrls: ['https://bsc-dataseed.binance.org/']
            }
            // Add more networks here if necessary
        ];

        let provider;

        // Check if MetaMask or another wallet provider is available
        if (typeof window.ethereum !== 'undefined') {
            provider = new ethers.providers.Web3Provider(window.ethereum);
        } else {
            document.getElementById('status').innerText = 'No wallet provider found. Please install MetaMask!';
        }

        async function connectWallet() {
            try {
                await provider.send('eth_requestAccounts', []);
                const signer = provider.getSigner();
                const address = await signer.getAddress();
                document.getElementById('status').innerText = `Connected with address: ${address}`;
                document.getElementById('connectButton').style.display = 'none';
                document.getElementById('disconnectButton').style.display = 'block';
            } catch (error) {
                console.error('Error connecting to wallet:', error);
                document.getElementById('status').innerText = `Error connecting to wallet: ${error.message}`;
            }
        }

        async function disconnectWallet() {
            try {
                // MetaMask does not have a direct disconnect method, so we simulate by reloading
                document.getElementById('status').innerText = 'Disconnected';
                document.getElementById('connectButton').style.display = 'block';
                document.getElementById('disconnectButton').style.display = 'none';
                window.location.reload();  // This will reset the session
            } catch (error) {
                console.error('Error disconnecting wallet:', error);
            }
        }

        async function switchNetwork(chainId) {
            try {
                const currentNetwork = await provider.getNetwork();
                if (currentNetwork.chainId !== chainId) {
                    const network = networks.find(net => net.chainId === chainId);
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: `0x${chainId.toString(16)}` }]
                    });
                    console.log(`Switched to network: ${network.name}`);
                    document.getElementById('status').innerText += `\nSwitched to ${network.name}.`;
                    
                    // Add a short delay to ensure the network switch completes fully
                    await new Promise(resolve => setTimeout(resolve, 1000));
                } else {
                    console.log(`Already on the correct network: ${currentNetwork.name}`);
                    document.getElementById('status').innerText += `\nAlready on ${currentNetwork.name}.`;
                }
            } catch (error) {
                console.error(`Error switching networks: ${error.message}`);
                if (error.code === 4902) {
                    const network = networks.find(net => net.chainId === chainId);
                    // If the network is not added, we can add it
                    await window.ethereum.request({
                        method: 'wallet_addEthereumChain',
                        params: [
                            {
                                chainId: `0x${chainId.toString(16)}`,
                                chainName: network.name,
                                nativeCurrency: {
                                    name: network.nativeSymbol,
                                    symbol: network.nativeSymbol,
                                    decimals: 18
                                },
                                rpcUrls: network.rpcUrls,
                                blockExplorerUrls: []
                            }
                        ]
                    });
                    console.log(`Added and switched to network: ${network.name}`);
                    document.getElementById('status').innerText += `\nAdded and switched to ${network.name}.`;
                }
            }
        }

        document.getElementById('connectButton').addEventListener('click', connectWallet);
        document.getElementById('disconnectButton').addEventListener('click', disconnectWallet);

        // Example: Call switchNetwork when you want to switch networks
        document.getElementById('switchNetworkButton').addEventListener('click', () => {
            // Replace `56` with the desired network chainId, e.g., 1 for Ethereum or 56 for Binance Smart Chain
            switchNetwork(56);
        });
    </script>
</body>
</html>
